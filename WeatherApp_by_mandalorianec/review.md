## Ревью на проект [WeatherApp](https://github.com/mandalorianec/WeatherApp)


## Плюсы

1. Хороший проект, видна работа над ошибками по предыдущим проектам, поэтому к 5-му уже элементарных косяков не допускается.

2. Приложение работает уже несколько дней (обычно деплои проектов так долго не живут), можно зарегистрироваться и посмотреть погоду.

3. Есть проверка логина и почты пользователя на существование, два одинаковых не даст зарегистрировать.
А также есть проверка на валидность введенного e-mail адреса. Хотя поле для ввода e-mail есть, но оно нигде не используются ?
Если ввести вместо логина e-mail и пароль, то авторизация не происходит (хотя такую фичу можно было реализовать тут)
Ошибки при регистрации выводятся на той же странице регистрации, это удобно.

4. Порядок добавления городов и порядок их вывода на странице совпадает, это тоже плюс.

5. Есть докер и докер-компоуз, это современно и удобно. По компоузу чуть улучшений: 
`image: nginx:latest` - тут лучше использовать конкретный тег, а не latest, так как через время latest будет перезаписываться, а нам нужна стабильность,
поэтому лучше указать конкретный тег `nginx:1.25-alpine` ну или на каком задеплоено сейчас.

Из плюсов в докер-компоузе есть `healthcheck`, такая штука и в кубере исользуется и в докере. Ещё можно добавить `healthcheck` для самого приложения джанго,
сделав ручку с адресом /healthcheck и швырять туда запросы каждые 30 секунд, если три попытки не удачные, 
то значит приложение лежит и перезапускаем весь докер.
Ну и ещё для приложения weather лучше разделить command на три части, чтобы всё выполнялось не одним куском,
а collectstatic - при сборке образа, migrate - в entrypoint скрипте с проверками, и gunicorn - основная команда.

6. В проекте используется асинхронная обертка над некоторыми функциями. И вообще используется асинк.

7. Есть кеширование локаций. 
То есть пользователь_1 добавить город_N, а все остальные пользователи если ищут этот же город, то получают его из кеша, технологично.

Правда время жизни кеша захардкожено в 600 секунд, такие значения лучше в config/settings куда-то выносить, 
складывать в энвы и иметь возможность менять там, не залезая в основной код.
То есть когда захотим например поменять на 900 секунд, то поменяем только передачу env в контейнер, 
эта операция будет без исправления кода, пересборки образа, а только лишь перезапуск докера.

8. Есть логгирование.


## Минусы

1. Наименования найденных локаций: ищем "Санкт-Петербург", находит "Saint Petersburg", ищем "Москва", находит "Moscow" и так далее.
Не хватает адаптации имен. Точно такой же как в самой погоде 'Clouds': 'Облачно'.

2. Если попытаться добавить один и тот же город, то ничего не происходит. 
Тут желательно вывести пользователю сообщение что такой город уже был добавлен.

3. Разрешается слабый пароль для пользователя. Смог зарегистрироваться с паролем "123" и "ццц".

4. В файле `selected_settings.py` есть такой импорт `from weather.weather.settings.base import *`, лучше избегать такой способ иморта,
а указывать что конкретно импортируется из модуля. Один из дзенов питона: явное лучше не явного. 
Может что-то лишнее будет импортировано, либо какое-то имя будет перезаписано. Здесь хороший подход импортировать весь модуль вот так:
`from weather.weather.settings import base`, и тогда при использовании будем обращаться к именам как `base.BASE_DIR` и так же в другим.
А так в целом идея разделения переменных на тестовые и продовые классная!

5. В тестах последний тест как будто не дописан до конца, переменная создается, но не используется в функции `test_network_error`
```api_response = async_to_sync(service.find_cities_by)("Berlin")```

6. Класс `class WeatherService` не используется инициализатор класса, при этом в каждый метод передается параметр `search_service: OpenWeatherService`
Лучше его объявить сразу в инициализаторе типа так `self.search_service = search_service or OpenWeatherService()`.
Функция `get_locations_for` не должна принимать объект search_service.

7. Местами используются методы с self, хотя они могут быть статическими, обращения к self нигде нет в методе,
например в классе `AddLocationView` метод `form_invalid`.

8. В методе `get_unique_locations` во вьюшке `SearchView` используется преобразование полученных координат в целые числа
```            
lat_digit = int(location['lat'])
lon_digit = int(location['lon'])
```
этого может быть нет необходимости делать, что прилетело от апи, то и положим, то и будем считать уникальными значениями,
а то вдруг функция int испортит нам уникальность.

9. Иконки для погоды берутся прямо с сайта openweathermap, это прикольно, но лушче их картинками в static в своем прокекте сохранить,
чтобы не грузить эту апишку лишними запросами. Хотя если оставлять запросы с апишки, то картинку кешировать, и искать сначала в кеше, а потом в апи.

10. Зависимости устанавливаются через `poetry`, но присутствует файлик с `requirements.txt`, и судя по составу этого файла он сгенерирован командой

```bash
pip freeze > requirements.txt
```

и все зависимости из установленных записались туда. 
На проде так не делается, в файле с requirements должны быть записаны только прямые минимально необходимые зависимости проекта.
Надо включать только те библиотеки, которые напрямую импортирются в коде проекта.
Не включайте транзитивные зависимости (зависимости ваших зависимостей) - они будут установлены автоматически pip'ом.
Ещё нашел что есть либа requests (не используется в проекте) и есть асинхронная aiohttp (она в проекте используется).
Если поработать с этим файлом, то в списке останеся 5-6 или чуть больше строк, а не 29 как сейчас.
В больших проектах их ещё больше, и сильный бардак может развиться с таким подходом.

11. Ну и мое любимое замечание, которое делаю всегда всем своим разработчкиам: именование .env переменных:

`SECRET_KEY` - это что за секретный ключ такой ? Что если в проекте ещё будут другие секретные ключи ? 
он ещё в проекте нигде и никак не используется, значит можно удалить совсем?

`API_KEY` - если в проекте будет использоваться несколько апи ? как эти ключи будем отличать ?

Здесь нужна максимально точно имя давать, чтобы любой другой разрабочтик сразу понял к чему относится переменная.
Хорошие кейсы в данном случае: `OPENWEATHERMAP_API_KEY` и `OPENWEATHERMAP_SECRET_KEY`

Да, имена получаются длинные, зато понятные сразу всем.


## Общий итог

Отличная работа! Видно улучшение качества кода по сравнению с предыдущим проектом. Продолжай в том же духе!
